from flask import Flask, request, jsonify
import sqlite3

app = Flask(__name__)

# Connect to SQLite database
def get_db_connection():
    conn = sqlite3.connect('database.db')
    conn.row_factory = sqlite3.Row
    return conn

@app.route('/secure', methods=['GET'])
def secure_query():
    user_id = request.args.get('id')
    
    # Using parameterized queries to prevent SQL injection
    query = 'SELECT * FROM users WHERE id = ?'
    
    conn = get_db_connection()
    user = conn.execute(query, (user_id,)).fetchone()
    conn.close()
    
    if user:
        return jsonify(dict(user)), 200
    else:
        return jsonify({'error': 'User not found'}), 404

if __name__ == '__main__':
    app.run(debug=True)

CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL
);

INSERT INTO users (name) VALUES ('Alice'), ('Bob'), ('Charlie');
